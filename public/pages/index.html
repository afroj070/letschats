<!DOCTYPE html><html class=''>
	<head>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
    <link rel="canonical" href="https://codepen.io/emilcarlsson/pen/ZOQZaV?limit=all&page=74&q=contact+" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700,300' rel='stylesheet' type='text/css'>
		
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel='stylesheet' href='./static/assets/css/bootstrap.min.css'>
		<link rel='stylesheet' href='./static/assets/css/style.css'>
		<script src="./static/assets/js/jquery.min.js"></script>
		<script src="./static/assets/js/bootstrap.min.js"></script>
		<script src="./static/assets/js/underscore-min.js"></script> 
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
		
</head>
<body>

<div id="frame">
	<div id="sidepanel">
		<div id="profile">			
		</div>
		<div id="search">
			<label for=""><i class="fa fa-search" aria-hidden="true"></i></label>
			<input type="text" placeholder="Search contacts..." />
		</div>
		<div id="contacts">		
		</div>
		<div id="bottom-bar">
			<button id="addcontact"><i class="fa fa-user-plus fa-fw" aria-hidden="true"></i> <span>Add contact</span></button>
			<button id="settings"><i class="fa fa-cog fa-fw" aria-hidden="true"></i> <span>Settings</span></button>
		</div>
	</div>
	<div class="content" id="content">		
	</div>
</div>

<div id="addContact" class="sidenav">
	<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
	<div class="container">
		<form action="">
			<div class="form-group">
			  <label for="email">Profile</label>
			  <input type="file" class="form-control" id="email" placeholder="Enter email" name="email">
			</div>

			<div class="form-group">
				<label for="email">Full Name</label>
				<input type="text" class="form-control" id="fullname" placeholder="Full Name" name="fullname">
			</div>
			<div class="form-group">
				<label for="email">Email</label>
				<input type="email" class="form-control" id="email" placeholder="Enter email" name="email">
			</div>
			<div class="form-group">
				<label for="email">Password</label>
				<input type="text" class="form-control" id="email" placeholder="Password" name="email">
			</div>
			<div class="form-group">
				<label for="email">Confirm-password</label>
				<input type="text" class="form-control" id="email" placeholder="Confirm-password" name="email">
			</div>
			<button type="submit" class="btn btn-primary">Submit</button>
		</form>
	</div>
</div>

<div id="settings_wrapper" class="sidenav">
		<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
		<div class="container">
			<form action="">				
				<div class="form-group">
					<label for="email">Email</label>
					<input type="email" class="form-control" id="email" placeholder="Enter email" name="email">
				</div>
				<div class="form-group">
					<label for="email">Password</label>
					<input type="email" class="form-control" id="email" placeholder="Enter email" name="email">
				</div>
				<button type="submit" class="btn btn-primary">Submit</button>
			</form>
		</div>
</div>
<script id="user-profile" type="text/template">
	<div class="wrap">
		<img id="profile-img" src="./static/assets/images/avatar.jpg" class="online" alt="" />
		<p><%= activeUser.name %></p>
		<i class="fa fa-power-off expand-button" aria-hidden="true"></i>
		<div id="status-options">
			<ul>
				<li id="status-online" class="active"><span class="status-circle"></span> <p>Online</p></li>
				<li id="status-away"><span class="status-circle"></span> <p>Away</p></li>
				<li id="status-busy"><span class="status-circle"></span> <p>Busy</p></li>
				<li id="status-offline"><span class="status-circle"></span> <p>Offline</p></li>
			</ul>
		</div>
		<div id="expanded">
			<label for="twitter"><i class="fa fa-facebook fa-fw" aria-hidden="true"></i></label>
			<input name="twitter" type="text" value="mikeross" />
			<label for="twitter"><i class="fa fa-twitter fa-fw" aria-hidden="true"></i></label>
			<input name="twitter" type="text" value="ross81" />
			<label for="twitter"><i class="fa fa-instagram fa-fw" aria-hidden="true"></i></label>
			<input name="twitter" type="text" value="mike.ross" />
		</div>
	</div>
</script>
<script id='contact-lists' type="text/template" >
	<ul>
		<% _.each(users, function(user) { %>

			<li class="contact" data-id='<%= user.id %>'>
					<div class="wrap">
						<span class="contact-status online"></span>
						<img src="./static/assets/images/avatar.jpg" alt="" />
						<div class="meta">
							<p class="name"><%= user.name %></p>
							<p><%= user.email %></p>
						</div>
					</div>
			</li>
		<%	}) %>			
	</ul>
</script>
<script id='content-lists' type="text/template" >
		<div class="contact-profile">
			<img src="./static/assets/images/avatar.jpg" alt="" />
			<p><%= userinfo.name %></p>
			<div class="social-media">
				<i class="fa fa-facebook" aria-hidden="true"></i>
				<i class="fa fa-twitter" aria-hidden="true"></i>
				<i class="fa fa-instagram" aria-hidden="true"></i>
			</div>
		</div>
		<div class="messages">
			<ul>
				<% _.each(chatinfos, function(chat){ %>
					<li class="<% if(chat.sender_id == userinfo.id ) { %> sent <% } else { %> replies <% } %>">
							<img src="./static/assets/images/avatar.jpg" alt="" />
							<p><%= chat.contents %></p>
					</li>
				<% }); %>		
			</ul>
		</div>
		<div class="message-input">
			<div class="wrap">
				<input type="text" id="message" data-for='<%= userinfo.id %>' placeholder="Write your message..." />
				<button class="submit">
						<i class="fa fa-paper-plane" aria-hidden="true"></i>
				</button>
			</div>
		</div>
	</div>
</script>



<script>
	$(document).ready(function() {
		var contactListsTemplate = _.template($('#contact-lists').html());
		var contentListsTemplate = _.template($('#content-lists').html());
		var userProfileTemplate  = _.template($('#user-profile').html());
		var activeUser = JSON.parse(localStorage.getItem('activeUser'));


		$.ajax({url: "/getAllUsers", method:'GET', success: function(result) {
			$('#profile').html(userProfileTemplate({activeUser:activeUser}));
			$('#contacts').html(contactListsTemplate({users:result.users}))
		}});

		// add contacts 
		$('#addcontact').click(()=>{
			$("#addContact").width('340px');
		});
		$('.closebtn').click(()=>{
			$("#addContact").width('0px');
			$('#settings_wrapper').width('0px');
		});
		// settings 
		$('#settings').click(()=>{
			$('#settings_wrapper').width('340px');
		});
		$('body').on('click','.contact', (e) => {
			var userData = null;
			var chatData = null;
			var id  = $(e.target).closest('li').attr('data-id');
			$.ajax({url: "/getchat/"+id, method:'GET', success: function(results) {
				var userFor = _.find(results.users, (result) => { return result.id != activeUser.id});
				localStorage.setItem('userFor',JSON.stringify(userFor));
				var contentInfo = {
					userinfo: userFor,
					chatinfos: results.chats,
				};
				$('#content').html(contentListsTemplate(contentInfo));			
			}});

		});
		
		// socket io
		var socket = io();

		//socket.emit('letsChat', $('#m').val());
		$('body').on('click','.submit', (e) => {
			var userFor = JSON.parse(localStorage.getItem('userFor'));
			var chatVal = $('#message').val();
			if(chatVal != '') {
				socket.emit('letsChat', {message:chatVal, dataFor:{recieverId:userFor.id}});
			}
		});

		socket.on('letsChat', function(chatData) {
			var userFor = JSON.parse(localStorage.getItem('userFor'));
			if(chatData.userFor_.id === activeUser.id || chatData.userFor_.id === userFor.id){
				var contentInfo = {
					userinfo: userFor,
					chatinfos: chatData.chats,
				};
				$('#content').html(contentListsTemplate(contentInfo));
			}
		
		});
	});
</script>
</body></html>